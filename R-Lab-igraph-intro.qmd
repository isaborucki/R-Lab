---
title: "Einführung in die Netzwerkanalyse"
author: Isabelle Borucki
format:
  revealjs:
    theme: solarized
    slide-number: true
    incremental: true
    center: true
    transition: fade
    font-size: 0.7em
    code-fold: true
    code-tools: true
  html:
    toc: true
execute:
  echo: true
  eval: true
  include: true
editor: visual
---

## Punkte, Linien und Strukturen: Was kann die soziale Netzwerkanalyse? Eine Einführung

-   Was sind Netzwerke?

-   Wie können wir damit empirisch-analytisch arbeiten?

## Eine Annäherung

![Quelle: Holzer, Boris Netzwerkworkshop Uni Konstanz, 2019](images/clipboard-527841116.png)

## Theorie

-   Nützliche Netzwerke:

    -   Sozialkapital:
    -   in soziale Netzwerke eingebettete Ressourcen, auf die Akteure zugreifen können (Nan Lin, Pierre Bourdieu)
    -   Verpflichtungen, Informationskanäle, Normen (James Coleman)

-   Netzwerk-Merkmale:

    -   Ressourcen
    -   Multiplexität
    -   Schließung

## Formalisierung

Soziale (Transaktions-)Beziehungen

-   Interaktion, Transaktion, (Aus-)Tausch

-   Partnerschaft, Konflikt

-   Kommunikation, Informationsflüsse

-   Bekanntschaft, Freundschaft, Verwandtschaft

Assoziative Beziehungen

-   (Un-)Ähnlichkeiten

-   Kontiguität

-   Gemeinsame Mitgliedschaft, Ko-Autorschaft

## Wozu Netzwerke?

-   Wozu brauchen wir Netzwerke?

-   Wozu Netzwerkanalysen?

## Arten von Netzwerken

-   Machtstrukturen
-   Soziale Interaktion
-   Wahlen, Einfluss auf Wahlentscheidung
-   Social Media Monitoring
-   Krankheiten, Pandemien
-   Kommunikationsmuster, Spachmodelle
-   Unternehmen
-   Zitationsnetzwerke Bsp. [connectedpapers](www.connectedpapers.com)
-   Molekularstrukturen

## Arten von Netzwerken

-   Gesamtnetzwerke

-   Ego-Netzwerke

## Strukturen von Netzwerken

-   Dichte
-   Zentralität
-   Homophilie
-   Cliquen
-   Brücken
-   Komponenten

## Strukturen von Netzwerken

![](images/clipboard-3338007500.png)

## Netzwerke messen

## Übersichtstabelle

| **Zentralitätsmaß** | **Positive Ausprägung** | **Typische Interpretation** | **Netzwerkcharakteristik** |
|---------------------|-------------------------|------------------------------|-----------------------------|
| **Degree** | „Local hero“ | Viele direkte Verbindungen, aber oft in einer vom Rest entfernten Teilgruppe | Zahlreiche, aber redundante Verbindungen |
| **Closeness** | Schlüssel zu anderen Teilen des Netzwerks | Ego ist über viele (kurze) Pfade erreichbar und zentral, aber andere sind ebenfalls gut angebunden | Viele Pfade, zentrale Position, aber nicht exklusiv |
| **Betweenness** | Zentrale Schnittstelle für Informationsfluss | Wenige direkte Verbindungen, aber entscheidend für die Verbindung verschiedener Gruppen | Selten: Bündelung der Beziehungen weniger Knoten zu allen anderen |

# Netzerkanalyse in R: Einführung in Igraph

## Was genau macht igraph?

Wie bei anderen Sachen in RStudio auch brauchen wir Pakete, das sind für Netzwerke eben genanntes `igraph` sowie zwei Pakete, um Daten einlesen zu können. Ein weiteres Paket ist [`visNetwork`](https://datastorm-open.github.io/visNetwork/)

```{r setup}
# Daten einlesen
library(tidyverse)
library(readxl)
library(readr)
# Daten analyieren/Netzwerkanalysen
# install.packages("igraph") sollte igraph noch nicht geladen sein
library(igraph) # meistgenutztes Paket für Netzwerkanalyse
library(visNetwork) # neueres paket zur Netzwerkanalyse
```

## Grundlagen

-   Knoten (nodes, vertices): Akteure, Organisationen, Individuen/Personen, Moleküle

-   Kanten (edges, links): Verbindungen, Interaktionen

-   Netzwerk? Graphen ...

-   *Netzwerk selbst kreieren: Wir legen fest, dass es ein Netzwerk mit drei Verbindungen sein soll.*

```{r first graph}
g <- make_graph( c(1,2, 1,3, 3,4), directed = FALSE)
g
```

## Grundlagen

Festlegen der Kanten über Kommata: 1 zu 2, 2 zu 3, 3 zu 4.

Eine andere Schreibweise:

```{r another graph, echo=TRUE, include=TRUE}
g1 <- make_graph( ~ A - B, B - C:D:E) #graph with undirected edges
g1
g2 <- make_graph( ~ 1 - 2, 2 - 3:4:5) #graph with undirected edges
g2
plot(g2)
```

## Eigenes Netzwerk

Wir können uns auch ein eigenes Netzwerk kreieren.

```{r network data frame, echo=TRUE}
### Data frames
survey <- data.frame(row.names=c("Alice", "Bob", "Cecil", "David", "Eve"),
                     Sex=c("F","M","F","F","F"),
                     Age=c(45,36,65,21,52),
                     Country=c("SUI", "USA", "SUI", "GBR", "USA"),
                     Married=c(TRUE, FALSE, FALSE, TRUE, TRUE),
                     Salary=c(70, 65, 200, 45, 100))
survey
survey$Sex
plot(survey$Age, survey$Salary)

AS.model <- lm(Salary ~ Age, data=survey)
AS.model
summary(AS.model)

tapply(survey$Salary, survey$Country, mean)
```

## Plots!

```{r test plot}
plot(g)
```

## Vorhandene Netzwerke: Daten einlesen

Daten von [GitHub](https://github.com/isaborucki/R-Lab/tree/20fd6d5a085b0689f180d7dfe8f541d41c48bdc6/data) einlesen.

```{r load data}
nodes <- read.csv("data/vertices.csv", header = T, sep = ";") 
links <- read.csv("data/edges.csv", header = T, as.is = T, sep = ";")
```

Daten anschauen:

```{r inspect data}
head(nodes)
head(links)
nrow(nodes); length(unique(nodes$id))
nrow(links); nrow(unique(links[,c("id", "to")]))
```

## Netzwerk "bauen"

Igraph muss das Netzwerk aus nodes und egdes zusammensetzen.

```{r make graph}
links <- links %>% 
  select(-X)
net <- graph_from_data_frame(d=links, vertices=nodes, directed=T) 

```

Netzwerk anschauen

```{r}
plot(net)
```

## Optimierung

Um Igraph Netzwerke zu optimieren:

```{r}
?igraph.plotting
plot(net, edge.arrow.size=.3, edge.curved=.1)

```

Wir können das Netzwerk auch noch manipulieren, dass es also besser aussieht, bzw. wir die Pfeile besser sehen können.

```{r}
E(net) # zeigt uns die Kanten/Links an
V(net) # zeigt uns die Knoten/Vertexe an

net[] # zeigt uns die Matrix des Netzwerks an - ACHTUNG: Eckige Klammer setzen.

net[1,]
```

## Attribute

Auch Attribute werden in igraph gespeichert, sie sind sowohl für Knoten als auch Kanten abrufbar.

```{r}
edge_attr(net)
vertex_attr(net)
E(net)$type
V(net)$media
```

## Und wieder plotten

```{r}
plot(net, edge.arrow.size=.5, vertex.label.color="black", vertex.label.dist=1.5,
     vertex.color=c( "pink", "skyblue")[1+(V(net)$media.type=="1")] )

#vereinfachen des Plots
nets <- simplify(net, remove.multiple = T, remove.loops = F, 
                 edge.attr.comb=c(weight="sum", type="ignore") )

plot(nets, vertex.label.dist=1.5)
```

Weitere Infos und die Daten gibt es auf GitHub bei [Katya Ognyanova](https://kateto.net/networks-r-igraph) sowie in der [igraph-Dokumentation](https://github.com/igraph/rigraph) bzw. [hier](https://r.igraph.org) ausführlich.

## Wer ist eigentlich zentral?

Zeige die Relationen im Datensatz
```{r}
as_data_frame(net, what = "edges")
```

Identifiziere und lösche loops (Selbstreferenzen)

```{r}
which_multiple(net, eids = E(net)) # shows which edges are loops
net <- simplify(net, remove.multiple = FALSE, remove.loops = TRUE)
E(net) # now shows 45 edges instead of 49
```

Vereinfache das Aussehen des Plots (Pfeilgröße, keine Labels):

```{r}
plot(net, edge.arrow.size = .4, vertex.label = NA)
```

### Zentralitätsmaße

```{r}
degree(net, mode = "in") # number of edges per node 
degree(net, mode = "out") # number of edges per node 
degree(net, mode = "all") # number of edges per node 

closeness(nets, weights = NULL) # closeness centrality
betweenness(nets) # betweenness centrality
edge_betweenness(nets) # edge betweenness
eigen_centrality(nets)$vector # eigenvector centrality
page_rank(nets)$vector # Google PageRank
```

Sammle alle Maße in einer Liste:

```{r}
cent <- list(Degree = degree(nets), 
             Closeness = closeness(nets), 
             Betweenness = betweenness(nets), 
             Eigenvector = eigen_centrality(nets)$vector, 
             PageRank = page_rank(nets)$vector)
cent
```

### Degree Distribution

```{r}
plot(degree_distribution(net, mode = "in"), log = "xy")
plot(degree_distribution(net, mode = "in"), log = "x")
plot(degree_distribution(net, mode = "in"), log = "y")
plot(degree_distribution(net, mode = "in"), ylog = TRUE, xlog = TRUE)

plot(degree_distribution(net, mode = "out"), log = "xy")
```

Wer hat den höchsten Degree?

```{r}
degree <- c(max(degree(net, mode = "in"))) # what does this function do? 
degree(net, mode = "out")
max(degree(net, mode = "all"))
degree # returns vector (6, 7, 13)
```

### Dichte und Netzwerkplot

```{r}
edge_density(net) # approx. 18.38% of possible ties are realized
is_directed(net) # TRUE (as plots already showed)
```


## Referenzen

Holster, J. D. (n.d.). *Chapter 7 Network Analysis \| Introduction to R for Data Science: A LISA 2020 Guidebook*. Retrieved November 22, 2023, from <https://bookdown.org/jdholster1/idsr/network-analysis.html>

Luke, D. (2015). *A User's Guide to Network Analysis in R*. Springer International Publishing. <https://doi.org/10.1007/978-3-319-23883-8>
